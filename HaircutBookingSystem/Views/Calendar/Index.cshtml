@model HaircutBookingSystem.ViewModels.CalendarAppointmentsViewModel

@{
    ViewData["Title"] = "Calendar";
}

<h1>Calendar</h1>

<div class="auth-wrap">
    <div class="auth-card">

        <form method="get" asp-controller="Calendar" asp-action="Index" class="mb-3">
            <label class="form-label">Filter by Stylist</label>

            <select class="form-select" name="stylistId" style="max-width:320px; margin:0 auto;"
                    onchange="this.form.submit()">
                @foreach (var s in Model.Stylists)
                {
                    <option value="@s.Value" selected="@(s.Selected ? "selected" : null)">@s.Text</option>
                }
            </select>

            <noscript>
                <div class="mt-2">
                    <button type="submit" class="btn btn-primary btn-cta">Filter</button>
                </div>
            </noscript>
        </form>

        <h4 class="mt-2">Booked Appointments</h4>

        <div class="table-responsive">
            <table class="table table-dark table-striped align-middle">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Full Name</th>
                        <th>Service</th>
                        <th>Email Address</th>
                        <th>Phone (optional)</th>
                    </tr>
                </thead>

                <tbody>
                    @if (Model.Rows == null || Model.Rows.Count == 0)
                    {
                        <tr>
                            <td colspan="6" class="text-center text-muted">No appointments found.</td>
                        </tr>
                    }
                    else
                    {
                        foreach (var r in Model.Rows)
                        {
                            <tr>
                                <td>@r.StartTime.ToString("yyyy-MM-dd")</td>
                                <td>@r.StartTime.ToString("hh:mm tt")</td>
                                <td>@r.FullName</td>
                                <td>@(string.IsNullOrWhiteSpace(r.Service) ? "—" : r.Service)</td>
                                <td>@r.Email</td>
                                <td>@(string.IsNullOrWhiteSpace(r.Phone) ? "—" : r.Phone)</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>

        <hr />

        <h4>Stylist Unavailabilities</h4>

        <div class="table-responsive">
            <table class="table table-dark table-striped align-middle">
                <thead>
                    <tr>
                        <th>Stylist</th>
                        <th>Start</th>
                        <th>End</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Unavailabilities == null || Model.Unavailabilities.Count == 0)
                    {
                        <tr>
                            <td colspan="3" class="text-center text-muted">No unavailabilities submitted.</td>
                        </tr>
                    }
                    else
                    {
                        foreach (var u in Model.Unavailabilities)
                        {
                            <tr>
                                <td>@u.StylistName</td>
                                <td>@u.StartDateTime.ToString("yyyy-MM-dd hh:mm tt")</td>
                                <td>@u.EndDateTime.ToString("yyyy-MM-dd hh:mm tt")</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>

    </div>
</div>
